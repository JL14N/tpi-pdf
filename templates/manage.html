<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gestionar PDFs — Pierre de Fermat Bank</title>
    <style>
      :root{ --primary: {{ '#b30000' if theme=='vulnerable' else ('#0b63ff' if theme=='secure' else '#0a8a2f') }}; --muted:#666 }
      body{ font-family:Inter, Arial, sans-serif; background:#f6f7f8; margin:0 }
      .wrap{ max-width:1000px; margin:30px auto; padding:18px }
      .top{ display:flex; justify-content:space-between; align-items:center }
      .card{ background:#fff; padding:16px; border-radius:8px; box-shadow:0 8px 20px rgba(0,0,0,0.06); margin-top:14px }
      .grid{ display:grid; grid-template-columns: repeat(2,1fr); gap:12px }
      .slot{ display:flex; gap:12px; align-items:center; padding:10px; border:1px solid rgba(0,0,0,0.06); border-radius:8px }
      .thumb{ width:140px; height:180px; background:#fafafa; border-radius:4px; overflow:hidden }
      .thumb embed{ width:100%; height:100% }
      .muted{ color:var(--muted) }
      .btn{ background:var(--primary); color:#fff; padding:8px 12px; border-radius:6px; border:0 }
      form.inline{ display:flex; gap:8px; align-items:center }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="top">
        <h1>Gestión de PDFs</h1>
        <div><a href="{{ url_for('logout') }}">Cerrar sesión</a></div>
      </div>

      <div class="card">
        <p class="muted">Sube o elimina archivos en los slots públicos (máx. 5).</p>
        <div class="grid">
          {% for s in slots %}
            <div class="slot">
              <div class="thumb">
                {% if s.filename %}
                  {% set basename = s.filename.rsplit('/',1)[-1] %}
                  {% set thumbname = 'thumbs/' + (basename.rsplit('.',1)[0] + '.png') %}
                  {% if thumbname in thumbs_available %}
                    <img src="{{ url_for('uploaded_file', filename=thumbname) }}" style="width:100%;height:100%;object-fit:cover" alt="Preview">
                  {% else %}
                    <div style="display:flex;align-items:center;justify-content:center;height:100%" class="muted">Sin vista previa</div>
                  {% endif %}
                {% else %}
                  <div style="display:flex;align-items:center;justify-content:center;height:100%" class="muted">Vacío</div>
                {% endif %}
              </div>
              <div style="flex:1">
                <div><strong>Slot {{ s.slot }}</strong></div>
                <div class="muted">{{ s.filename if s.filename else 'Sin archivo' }}</div>
                <div style="margin-top:8px">
                  <form class="inline" action="{{ url_for('manage_upload') }}" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="slot" value="{{ s.slot }}">
                    <input type="file" name="file" accept="application/pdf" required>
                    <button class="btn" type="submit">Subir</button>
                  </form>
                  {% if s.filename %}
                    <div style="margin-top:8px"><a href="{{ url_for('manage_delete') }}?slot={{ s.slot }}">Eliminar</a></div>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </body>
</html>
